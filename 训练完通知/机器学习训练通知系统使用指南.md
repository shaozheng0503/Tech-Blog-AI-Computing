# 机器学习训练完成通知系统使用指南

## 📋 目录

- [系统概述](#系统概述)
- [功能特性](#功能特性)
- [安装配置](#安装配置)
- [详细使用步骤](#详细使用步骤)
- [通知方式配置](#通知方式配置)
- [高级功能](#高级功能)
- [故障排除](#故障排除)
- [最佳实践](#最佳实践)

## 🎯 系统概述

机器学习训练通知系统是一个Python程序，能够在机器学习模型训练完成后自动发送通知到您的邮箱、微信或手机，并生成详细的训练报告。无论您是在本地训练还是在云服务器上训练，都能及时获得训练完成的通知。

### 主要应用场景

- **长时间训练监控**：监控需要数小时甚至数天的模型训练
- **云服务器训练**：在云主机上训练时及时获得通知
- **批量训练管理**：管理多个模型的训练任务
- **团队协作**：团队成员共享训练状态和结果

## ✨ 功能特性

### 🔔 多种通知方式
- **邮件通知**：支持Gmail、QQ邮箱、企业邮箱等
- **微信通知**：支持钉钉机器人、企业微信应用
- **短信通知**：支持阿里云、腾讯云短信服务

### 📊 智能监控
- **实时监控**：监控训练进度和系统资源
- **自动检测**：自动检测训练完成状态
- **资源监控**：监控GPU、内存使用情况

### 📈 详细报告
- **训练指标**：准确率、损失值、训练时长等
- **系统资源**：GPU使用率、内存使用率
- **性能分析**：训练效率、模型表现评估

## 🛠️ 安装配置

### 1. 环境要求

```bash
Python 3.7+
pip 20.0+
```

### 2. 安装依赖包

```bash
# 基础依赖
pip install pyyaml requests psutil GPUtil

# 邮件通知依赖（已内置）
# 微信通知依赖（已内置）

# 短信通知依赖（可选）
pip install aliyun-python-sdk-core aliyun-python-sdk-dysmsapi
pip install tencentcloud-sdk-python

# 数据分析和可视化（可选）
pip install pandas matplotlib seaborn
```

### 3. 下载程序

```bash
# 下载主程序
wget https://raw.githubusercontent.com/your-repo/ml_training_notifier.py

# 或者直接复制代码到本地文件
```

## 📝 详细使用步骤

### 步骤1：创建配置文件

运行程序会自动生成配置文件模板：

```bash
python ml_training_notifier.py
```

这将创建 `notifier_config.yaml` 文件。

### 步骤2：配置通知设置

编辑 `notifier_config.yaml` 文件：

```yaml
notifications:
  email_enabled: true
  wechat_enabled: true
  phone_enabled: false
  
  email:
    smtp_server: smtp.gmail.com
    smtp_port: 587
    username: your_email@gmail.com
    password: your_app_password  # Gmail应用专用密码
    from_email: your_email@gmail.com
    to_emails: ['recipient@example.com']
  
  wechat:
    webhook_url: https://oapi.dingtalk.com/robot/send?access_token=your_token
    # 或者使用企业微信
    # access_token: your_wechat_token
    # agent_id: your_agent_id
    # corp_id: your_corp_id
    # secret: your_secret
  
  phone:
    provider: aliyun  # aliyun 或 tencent
    api_key: your_api_key
    api_secret: your_api_secret
    phone_numbers: ['13800138000']
    sign_name: ML训练
    template_code: SMS_123456789
```

### 步骤3：集成到训练代码

#### 方法1：直接集成（推荐）

```python
from ml_training_notifier import TrainingMonitor

# 初始化监控器
monitor = TrainingMonitor()

# 开始监控训练
monitor.start_monitoring(
    model_name="ResNet50",
    training_func=your_training_function,  # 您的训练函数
    epochs=100,
    dataset_size=50000,
    batch_size=32,
    learning_rate=0.001,
    optimizer="Adam"
)

# 您的训练函数
def your_training_function(epochs, **kwargs):
    # 您的训练代码
    for epoch in range(epochs):
        # 训练逻辑
        pass
    
    # 返回训练结果
    return {
        'final_loss': 0.1234,
        'final_accuracy': 0.95,
        'best_epoch': 85,
        'best_accuracy': 0.96,
        'epochs': epochs
    }
```

#### 方法2：独立监控

```python
from ml_training_notifier import TrainingMonitor
import time

# 初始化监控器
monitor = TrainingMonitor()

# 开始监控（不提供训练函数）
monitor.start_monitoring(
    model_name="ResNet50",
    epochs=100,
    dataset_size=50000
)

# 手动停止监控（训练完成后）
time.sleep(3600)  # 等待1小时
monitor.stop_monitoring()
```

### 步骤4：运行程序

```bash
# 运行示例
python ml_training_notifier.py

# 或者集成到您的训练脚本中
python your_training_script.py
```

## 📧 通知方式配置

### 1. 邮件通知配置

#### Gmail配置

1. **开启两步验证**
   - 登录Gmail账户
   - 进入"安全性"设置
   - 开启"两步验证"

2. **生成应用专用密码**
   - 在"安全性"设置中找到"应用专用密码"
   - 生成新的应用专用密码
   - 复制生成的16位密码

3. **配置文件设置**

```yaml
email:
  smtp_server: smtp.gmail.com
  smtp_port: 587
  username: your_email@gmail.com
  password: your_16_digit_app_password
  from_email: your_email@gmail.com
  to_emails: ['recipient@example.com']
```

#### QQ邮箱配置

```yaml
email:
  smtp_server: smtp.qq.com
  smtp_port: 587
  username: your_qq@qq.com
  password: your_authorization_code  # QQ邮箱授权码
  from_email: your_qq@qq.com
  to_emails: ['recipient@example.com']
```

### 2. 微信通知配置

#### 钉钉机器人配置

1. **创建钉钉群**
2. **添加自定义机器人**
   - 群设置 → 智能群助手 → 添加机器人 → 自定义
   - 设置机器人名称和头像
   - 获取Webhook地址

3. **配置文件设置**

```yaml
wechat:
  webhook_url: https://oapi.dingtalk.com/robot/send?access_token=your_token
```

#### 企业微信配置

1. **注册企业微信**
2. **创建应用**
   - 进入"应用管理" → "应用" → "创建应用"
   - 获取AgentId、CorpId、Secret

3. **配置文件设置**

```yaml
wechat:
  access_token: your_wechat_token
  agent_id: your_agent_id
  corp_id: your_corp_id
  secret: your_secret
```

### 3. 短信通知配置

#### 阿里云短信配置

1. **注册阿里云账户**
2. **开通短信服务**
3. **创建AccessKey**
4. **申请短信签名和模板**

```yaml
phone:
  provider: aliyun
  api_key: your_access_key_id
  api_secret: your_access_key_secret
  phone_numbers: ['13800138000']
  sign_name: ML训练
  template_code: SMS_123456789
```

#### 腾讯云短信配置

```yaml
phone:
  provider: tencent
  api_key: your_secret_id
  api_secret: your_secret_key
  phone_numbers: ['13800138000']
  sign_name: ML训练
  sdk_app_id: your_sdk_app_id
  template_id: your_template_id
```

## 🚀 高级功能

### 1. 自定义训练检测

```python
class CustomTrainingMonitor(TrainingMonitor):
    def _is_training_completed(self) -> bool:
        """自定义训练完成检测逻辑"""
        # 检查模型文件是否存在
        model_path = f"models/{self.metrics.model_name}.pth"
        if os.path.exists(model_path):
            return True
        
        # 检查训练日志
        log_path = f"logs/{self.metrics.model_name}.log"
        if os.path.exists(log_path):
            with open(log_path, 'r') as f:
                content = f.read()
                if "Training completed" in content:
                    return True
        
        return False
```

### 2. 自定义报告格式

```python
def custom_report_generator(metrics):
    """自定义报告生成器"""
    report = f"""
# 自定义训练报告

## 模型信息
- 名称: {metrics.model_name}
- 状态: {metrics.status}
- 训练时长: {metrics.duration:.2f} 小时

## 自定义指标
- 自定义指标1: 值1
- 自定义指标2: 值2
    """
    return report
```

### 3. 批量训练监控

```python
def monitor_multiple_training():
    """监控多个训练任务"""
    models = [
        {"name": "ResNet50", "epochs": 100},
        {"name": "VGG16", "epochs": 50},
        {"name": "InceptionV3", "epochs": 75}
    ]
    
    monitors = []
    for model in models:
        monitor = TrainingMonitor()
        monitor.start_monitoring(
            model_name=model["name"],
            epochs=model["epochs"]
        )
        monitors.append(monitor)
    
    # 等待所有训练完成
    for monitor in monitors:
        while monitor.monitoring:
            time.sleep(1)
```

## 🔧 故障排除

### 常见问题及解决方案

#### 1. 邮件发送失败

**问题**：`SMTPAuthenticationError: (535, b'Authentication failed')`

**解决方案**：
- 检查用户名和密码是否正确
- 确认开启了应用专用密码
- 检查SMTP服务器和端口设置

#### 2. 微信通知失败

**问题**：`HTTPError: 400 Client Error`

**解决方案**：
- 检查Webhook URL是否正确
- 确认机器人没有被禁用
- 检查消息格式是否符合要求

#### 3. 短信发送失败

**问题**：`TemplateCode not found`

**解决方案**：
- 检查短信模板代码是否正确
- 确认短信签名已审核通过
- 检查API密钥权限

#### 4. GPU监控失败

**问题**：`No module named 'GPUtil'`

**解决方案**：
```bash
pip install GPUtil
```

### 日志查看

程序会自动生成日志文件 `ml_notifier.log`：

```bash
# 查看实时日志
tail -f ml_notifier.log

# 查看错误日志
grep "ERROR" ml_notifier.log
```

## 💡 最佳实践

### 1. 配置管理

- **环境变量**：敏感信息使用环境变量
- **配置文件**：不同环境使用不同配置文件
- **版本控制**：不要将包含密码的配置文件提交到版本控制

### 2. 通知策略

- **邮件通知**：适合重要训练任务
- **微信通知**：适合日常监控
- **短信通知**：适合紧急情况

### 3. 性能优化

- **检查间隔**：根据训练时长调整检查间隔
- **资源监控**：合理设置资源使用阈值
- **报告生成**：避免在训练过程中生成大量报告

### 4. 安全考虑

- **API密钥**：定期轮换API密钥
- **访问权限**：限制通知接收者
- **日志安全**：避免在日志中记录敏感信息

## 📚 扩展阅读

### 相关文档

- [Python SMTP文档](https://docs.python.org/3/library/smtplib.html)
- [钉钉机器人API](https://developers.dingtalk.com/document/robots/custom-robot-access)
- [企业微信API](https://work.weixin.qq.com/api/doc/90000/90135/90236)
- [阿里云短信API](https://help.aliyun.com/document_detail/101414.html)

### 示例代码

完整示例代码请参考 `ml_training_notifier.py` 文件。

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进这个项目！

### 贡献方式

1. Fork项目
2. 创建功能分支
3. 提交更改
4. 创建Pull Request

### 代码规范

- 遵循PEP 8代码规范
- 添加适当的注释和文档
- 编写单元测试

## 📄 许可证

本项目采用MIT许可证，详见LICENSE文件。

---

**最后更新**：2024年12月

**版本**：1.0.0

**作者**：AI Assistant

如有问题，请提交Issue或联系作者。 
# äº‘ä¸»æœºJupyterLabå¼€å‘è½¬ServerlessæœåŠ¡éƒ¨ç½²å®Œæ•´æŒ‡å—

## ğŸ“‹ æ¦‚è§ˆ

æœ¬æŒ‡å—å°†å¸¦æ‚¨å®Œæˆä»äº‘ä¸»æœºJupyterLabç¯å¢ƒå¼€å‘ç¨‹åºåˆ°ServerlessæœåŠ¡éƒ¨ç½²çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…å«ç¤ºä¾‹ç¨‹åºã€é…ç½®æ–‡ä»¶å’Œè¯¦ç»†æ­¥éª¤ã€‚

## ğŸ¯ ç›®æ ‡åœºæ™¯

- **å¼€å‘ç¯å¢ƒ**: äº‘ä¸»æœºJupyterLab
- **å¼€å‘å†…å®¹**: Python Web APIæœåŠ¡
- **éƒ¨ç½²ç›®æ ‡**: Serverlesså¹³å°ï¼ˆAWS Lambda/é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—/è…¾è®¯äº‘å‡½æ•°ï¼‰
- **æŠ€æœ¯æ ˆ**: Python + FastAPI + Docker + Serverless Framework

## ğŸ“ é¡¹ç›®ç»“æ„

```
serverless-project/
â”œâ”€â”€ notebooks/                    # JupyterLabå¼€å‘ç›®å½•
â”‚   â”œâ”€â”€ development.ipynb        # å¼€å‘è°ƒè¯•ç¬”è®°æœ¬
â”‚   â””â”€â”€ testing.ipynb           # æµ‹è¯•éªŒè¯ç¬”è®°æœ¬
â”œâ”€â”€ src/                         # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ app.py                   # ä¸»åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ handler.py               # Serverlesså¤„ç†å™¨
â”‚   â”œâ”€â”€ models/                  # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ schemas.py
â”‚   â”œâ”€â”€ services/                # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â””â”€â”€ api_service.py
â”‚   â””â”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ helpers.py
â”œâ”€â”€ tests/                       # æµ‹è¯•ç›®å½•
â”‚   â””â”€â”€ test_api.py
â”œâ”€â”€ deployment/                  # éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ serverless.yml          # Serverlessé…ç½®
â”‚   â”œâ”€â”€ requirements.txt         # Pythonä¾èµ–
â”‚   â””â”€â”€ Dockerfile              # Dockeré…ç½®
â”œâ”€â”€ README.md                    # é¡¹ç›®æ–‡æ¡£
â””â”€â”€ setup.py                    # æ‰“åŒ…é…ç½®
```

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šJupyterLabç¯å¢ƒå‡†å¤‡

### 1.1 åˆ›å»ºé¡¹ç›®ç›®å½•

```bash
# åœ¨äº‘ä¸»æœºä¸­åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir ~/serverless-project
cd ~/serverless-project

# åˆ›å»ºç›®å½•ç»“æ„
mkdir -p notebooks src/models src/services src/utils tests deployment
```

### 1.2 å®‰è£…å¿…è¦ä¾èµ–

```bash
# å®‰è£…å¼€å‘ä¾èµ–
pip install fastapi uvicorn python-multipart pydantic
pip install jupyter jupyterlab
pip install requests pytest
pip install serverless-framework boto3
```

## ğŸ’» ç¬¬äºŒæ­¥ï¼šJupyterLabä¸­å¼€å‘ç¨‹åº

### 2.1 åˆ›å»ºå¼€å‘ç¬”è®°æœ¬

**notebooks/development.ipynb** å†…å®¹ï¼š

```python
# Cell 1: å¯¼å…¥å¿…è¦åº“
import sys
sys.path.append('../src')

from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
import uvicorn
import json
from typing import List, Dict, Any

# Cell 2: å®šä¹‰æ•°æ®æ¨¡å‹
class UserModel(BaseModel):
    id: int
    name: str
    email: str
    age: int

class CreateUserRequest(BaseModel):
    name: str
    email: str
    age: int

class APIResponse(BaseModel):
    success: bool
    message: str
    data: Any = None

# Cell 3: æ¨¡æ‹Ÿæ•°æ®åº“
users_db = [
    {"id": 1, "name": "å¼ ä¸‰", "email": "zhangsan@example.com", "age": 25},
    {"id": 2, "name": "æå››", "email": "lisi@example.com", "age": 30}
]

# Cell 4: åˆ›å»ºFastAPIåº”ç”¨
app = FastAPI(title="ç”¨æˆ·ç®¡ç†API", version="1.0.0")

@app.get("/")
async def root():
    return APIResponse(success=True, message="APIæœåŠ¡è¿è¡Œæ­£å¸¸")

@app.get("/users", response_model=APIResponse)
async def get_users():
    return APIResponse(
        success=True, 
        message="è·å–ç”¨æˆ·åˆ—è¡¨æˆåŠŸ", 
        data=users_db
    )

@app.get("/users/{user_id}", response_model=APIResponse)
async def get_user(user_id: int):
    user = next((u for u in users_db if u["id"] == user_id), None)
    if not user:
        raise HTTPException(status_code=404, detail="ç”¨æˆ·ä¸å­˜åœ¨")
    return APIResponse(
        success=True, 
        message="è·å–ç”¨æˆ·æˆåŠŸ", 
        data=user
    )

@app.post("/users", response_model=APIResponse)
async def create_user(user: CreateUserRequest):
    new_id = max([u["id"] for u in users_db]) + 1 if users_db else 1
    new_user = {
        "id": new_id,
        "name": user.name,
        "email": user.email,
        "age": user.age
    }
    users_db.append(new_user)
    return APIResponse(
        success=True, 
        message="åˆ›å»ºç”¨æˆ·æˆåŠŸ", 
        data=new_user
    )

# Cell 5: æµ‹è¯•è¿è¡Œ
if __name__ == "__main__":
    # åœ¨Jupyterä¸­æµ‹è¯•
    import threading
    import time
    
    def run_server():
        uvicorn.run(app, host="0.0.0.0", port=8000)
    
    # å¯åŠ¨æœåŠ¡å™¨ï¼ˆåå°è¿è¡Œï¼‰
    server_thread = threading.Thread(target=run_server, daemon=True)
    server_thread.start()
    time.sleep(2)
    print("APIæœåŠ¡å·²å¯åŠ¨: http://localhost:8000")

# Cell 6: APIæµ‹è¯•
import requests

# æµ‹è¯•åŸºæœ¬è¿æ¥
response = requests.get("http://localhost:8000/")
print("åŸºç¡€æµ‹è¯•:", response.json())

# æµ‹è¯•è·å–ç”¨æˆ·åˆ—è¡¨
response = requests.get("http://localhost:8000/users")
print("ç”¨æˆ·åˆ—è¡¨:", response.json())

# æµ‹è¯•åˆ›å»ºç”¨æˆ·
new_user = {
    "name": "ç‹äº”",
    "email": "wangwu@example.com", 
    "age": 28
}
response = requests.post("http://localhost:8000/users", json=new_user)
print("åˆ›å»ºç”¨æˆ·:", response.json())
```

### 2.2 ä¿å­˜ä¸ºPythonæ¨¡å—

å°†åœ¨Jupyterä¸­å¼€å‘çš„ä»£ç æ‹†åˆ†ä¸ºæ¨¡å—ï¼š

**src/models/schemas.py**:
```python
from pydantic import BaseModel
from typing import Any

class UserModel(BaseModel):
    id: int
    name: str
    email: str
    age: int

class CreateUserRequest(BaseModel):
    name: str
    email: str
    age: int

class APIResponse(BaseModel):
    success: bool
    message: str
    data: Any = None
```

**src/services/api_service.py**:
```python
from typing import List, Dict, Optional
from models.schemas import UserModel, CreateUserRequest

class UserService:
    def __init__(self):
        self.users_db = [
            {"id": 1, "name": "å¼ ä¸‰", "email": "zhangsan@example.com", "age": 25},
            {"id": 2, "name": "æå››", "email": "lisi@example.com", "age": 30}
        ]
    
    def get_all_users(self) -> List[Dict]:
        return self.users_db
    
    def get_user_by_id(self, user_id: int) -> Optional[Dict]:
        return next((u for u in self.users_db if u["id"] == user_id), None)
    
    def create_user(self, user_data: CreateUserRequest) -> Dict:
        new_id = max([u["id"] for u in self.users_db]) + 1 if self.users_db else 1
        new_user = {
            "id": new_id,
            "name": user_data.name,
            "email": user_data.email,
            "age": user_data.age
        }
        self.users_db.append(new_user)
        return new_user
```

**src/app.py**:
```python
from fastapi import FastAPI, HTTPException
from models.schemas import APIResponse, CreateUserRequest
from services.api_service import UserService

app = FastAPI(title="ç”¨æˆ·ç®¡ç†API", version="1.0.0")
user_service = UserService()

@app.get("/")
async def root():
    return APIResponse(success=True, message="APIæœåŠ¡è¿è¡Œæ­£å¸¸")

@app.get("/users", response_model=APIResponse)
async def get_users():
    users = user_service.get_all_users()
    return APIResponse(success=True, message="è·å–ç”¨æˆ·åˆ—è¡¨æˆåŠŸ", data=users)

@app.get("/users/{user_id}", response_model=APIResponse)
async def get_user(user_id: int):
    user = user_service.get_user_by_id(user_id)
    if not user:
        raise HTTPException(status_code=404, detail="ç”¨æˆ·ä¸å­˜åœ¨")
    return APIResponse(success=True, message="è·å–ç”¨æˆ·æˆåŠŸ", data=user)

@app.post("/users", response_model=APIResponse)
async def create_user(user: CreateUserRequest):
    new_user = user_service.create_user(user)
    return APIResponse(success=True, message="åˆ›å»ºç”¨æˆ·æˆåŠŸ", data=new_user)

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

## ğŸ”„ ç¬¬ä¸‰æ­¥ï¼šè½¬æ¢ä¸ºServerlesså…¼å®¹æ ¼å¼

### 3.1 åˆ›å»ºServerlesså¤„ç†å™¨

**src/handler.py**:
```python
import json
from mangum import Mangum
from app import app

# åˆ›å»ºMangumå¤„ç†å™¨ï¼Œç”¨äºAWS Lambda
lambda_handler = Mangum(app)

def serverless_handler(event, context):
    """
    é€šç”¨Serverlesså¤„ç†å™¨
    æ”¯æŒAWS Lambdaã€é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—ã€è…¾è®¯äº‘å‡½æ•°
    """
    return lambda_handler(event, context)

# é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—å¤„ç†å™¨
def aliyun_handler(environ, start_response):
    from mangum import Mangum
    handler = Mangum(app)
    return handler(environ, start_response)

# è…¾è®¯äº‘å‡½æ•°å¤„ç†å™¨
def tencent_handler(event, context):
    return lambda_handler(event, context)
```

### 3.2 åˆ›å»ºä¾èµ–æ–‡ä»¶

**deployment/requirements.txt**:
```txt
fastapi==0.104.1
uvicorn==0.24.0
pydantic==2.5.0
mangum==0.17.0
python-multipart==0.0.6
```

### 3.3 åˆ›å»ºServerlessé…ç½®

**deployment/serverless.yml**:
```yaml
service: user-management-api

provider:
  name: aws
  runtime: python3.9
  region: us-west-2
  stage: ${opt:stage, 'dev'}
  timeout: 30
  memorySize: 256
  environment:
    STAGE: ${self:provider.stage}
  
functions:
  api:
    handler: src.handler.lambda_handler
    events:
      - http:
          path: /
          method: ANY
          cors: true
      - http:
          path: /{proxy+}
          method: ANY
          cors: true

plugins:
  - serverless-python-requirements

custom:
  pythonRequirements:
    dockerizePip: true
    zip: true
    slim: true
    strip: false
    noDeps: false
    pipCmdExtraArgs:
      - --cache-dir
      - .requirements-cache

package:
  individually: false
  exclude:
    - node_modules/**
    - .git/**
    - .pytest_cache/**
    - tests/**
    - notebooks/**
    - "*.pyc"
    - "**/__pycache__/**"
```

### 3.4 åˆ›å»ºDockeré…ç½®ï¼ˆå¯é€‰ï¼‰

**deployment/Dockerfile**:
```dockerfile
FROM public.ecr.aws/lambda/python:3.9

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY deployment/requirements.txt ${LAMBDA_TASK_ROOT}/

# å®‰è£…ä¾èµ–
RUN pip install -r requirements.txt

# å¤åˆ¶æºä»£ç 
COPY src/ ${LAMBDA_TASK_ROOT}/src/

# è®¾ç½®å¤„ç†å™¨
CMD ["src.handler.lambda_handler"]
```

## ğŸ§ª ç¬¬å››æ­¥ï¼šæœ¬åœ°æµ‹è¯•

### 4.1 åˆ›å»ºæµ‹è¯•æ–‡ä»¶

**tests/test_api.py**:
```python
import pytest
import sys
import os
sys.path.append(os.path.join(os.path.dirname(__file__), '../src'))

from fastapi.testclient import TestClient
from app import app

client = TestClient(app)

def test_root():
    response = client.get("/")
    assert response.status_code == 200
    data = response.json()
    assert data["success"] == True

def test_get_users():
    response = client.get("/users")
    assert response.status_code == 200
    data = response.json()
    assert data["success"] == True
    assert len(data["data"]) >= 2

def test_get_user_by_id():
    response = client.get("/users/1")
    assert response.status_code == 200
    data = response.json()
    assert data["success"] == True
    assert data["data"]["id"] == 1

def test_create_user():
    new_user = {
        "name": "æµ‹è¯•ç”¨æˆ·",
        "email": "test@example.com",
        "age": 25
    }
    response = client.post("/users", json=new_user)
    assert response.status_code == 200
    data = response.json()
    assert data["success"] == True
    assert data["data"]["name"] == "æµ‹è¯•ç”¨æˆ·"

def test_get_nonexistent_user():
    response = client.get("/users/999")
    assert response.status_code == 404
```

### 4.2 è¿è¡Œæµ‹è¯•

```bash
# åœ¨äº‘ä¸»æœºä¸­è¿è¡Œæµ‹è¯•
cd ~/serverless-project
python -m pytest tests/ -v
```

### 4.3 æœ¬åœ°Serverlessæ¨¡æ‹Ÿ

**notebooks/testing.ipynb**:
```python
# Cell 1: æµ‹è¯•Serverlesså¤„ç†å™¨
import sys
sys.path.append('../src')
from handler import lambda_handler

# æ¨¡æ‹ŸAWS Lambdaäº‹ä»¶
test_event = {
    "httpMethod": "GET",
    "path": "/users",
    "headers": {},
    "queryStringParameters": None,
    "body": None,
    "isBase64Encoded": False
}

test_context = {}

# Cell 2: æµ‹è¯•å¤„ç†å™¨
result = lambda_handler(test_event, test_context)
print("Serverlessæµ‹è¯•ç»“æœ:", result)

# Cell 3: æµ‹è¯•POSTè¯·æ±‚
import json

post_event = {
    "httpMethod": "POST", 
    "path": "/users",
    "headers": {"Content-Type": "application/json"},
    "queryStringParameters": None,
    "body": json.dumps({
        "name": "Serverlessç”¨æˆ·",
        "email": "serverless@example.com",
        "age": 30
    }),
    "isBase64Encoded": False
}

post_result = lambda_handler(post_event, test_context)
print("POSTæµ‹è¯•ç»“æœ:", post_result)
```

## ğŸš€ ç¬¬äº”æ­¥ï¼šéƒ¨ç½²åˆ°Serverlesså¹³å°

### 5.1 AWS Lambdaéƒ¨ç½²

```bash
# å®‰è£…Serverless Framework
npm install -g serverless

# å®‰è£…æ’ä»¶
cd ~/serverless-project/deployment
npm init -y
npm install --save-dev serverless-python-requirements

# é…ç½®AWSå‡­è¯
serverless config credentials --provider aws --key YOUR_KEY --secret YOUR_SECRET

# éƒ¨ç½²
serverless deploy --stage prod
```

### 5.2 é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—éƒ¨ç½²

åˆ›å»º **deployment/fun.yml**:
```yaml
ROSTemplateFormatVersion: '2015-09-01'
Transform: 'Aliyun::Serverless-2018-04-03'
Resources:
  user-api:
    Type: 'Aliyun::Serverless::Service'
    Properties:
      Description: 'ç”¨æˆ·ç®¡ç†APIæœåŠ¡'
    api:
      Type: 'Aliyun::Serverless::Function'
      Properties:
        Handler: src.handler.aliyun_handler
        Runtime: python3.9
        CodeUri: '../'
        MemorySize: 256
        Timeout: 30
        Events:
          httpTrigger:
            Type: HTTP
            Properties:
              AuthType: ANONYMOUS
              Methods: ['GET', 'POST', 'PUT', 'DELETE']
```

éƒ¨ç½²å‘½ä»¤ï¼š
```bash
# å®‰è£…Funå·¥å…·
npm install @alicloud/fun -g

# éƒ¨ç½²
fun deploy
```

### 5.3 è…¾è®¯äº‘å‡½æ•°éƒ¨ç½²

åˆ›å»º **deployment/serverless-tencent.yml**:
```yaml
component: scf
name: user-api

inputs:
  name: user-management-api
  src: ../src
  handler: handler.tencent_handler
  runtime: Python3.6
  region: ap-guangzhou
  events:
    - apigw:
        parameters:
          protocols:
            - http
            - https
          serviceName: user-api
          description: ç”¨æˆ·ç®¡ç†API
          environment: release
          endpoints:
            - path: /
              method: ANY
```

éƒ¨ç½²å‘½ä»¤ï¼š
```bash
# å®‰è£…Serverless Framework
npm install -g serverless

# éƒ¨ç½²
serverless deploy
```

## ğŸ“Š ç¬¬å…­æ­¥ï¼šç›‘æ§å’Œæµ‹è¯•

### 6.1 åˆ›å»ºç›‘æ§è„šæœ¬

**tests/load_test.py**:
```python
import requests
import time
import json
import threading
from concurrent.futures import ThreadPoolExecutor

# æ›¿æ¢ä¸ºä½ çš„ServerlessæœåŠ¡URL
BASE_URL = "https://your-api-gateway-url.amazonaws.com/prod"

def test_endpoint(endpoint, method="GET", data=None):
    """æµ‹è¯•å•ä¸ªç«¯ç‚¹"""
    try:
        if method == "GET":
            response = requests.get(f"{BASE_URL}{endpoint}")
        elif method == "POST":
            response = requests.post(f"{BASE_URL}{endpoint}", json=data)
        
        return {
            "endpoint": endpoint,
            "status_code": response.status_code,
            "response_time": response.elapsed.total_seconds(),
            "success": response.status_code == 200
        }
    except Exception as e:
        return {
            "endpoint": endpoint,
            "error": str(e),
            "success": False
        }

def load_test(concurrent_users=10, test_duration=60):
    """è´Ÿè½½æµ‹è¯•"""
    results = []
    start_time = time.time()
    
    def worker():
        while time.time() - start_time < test_duration:
            # æµ‹è¯•å„ä¸ªç«¯ç‚¹
            results.append(test_endpoint("/"))
            results.append(test_endpoint("/users"))
            results.append(test_endpoint("/users/1"))
            results.append(test_endpoint("/users", "POST", {
                "name": f"æµ‹è¯•ç”¨æˆ·{time.time()}",
                "email": f"test{time.time()}@example.com",
                "age": 25
            }))
            time.sleep(1)
    
    # å¯åŠ¨å¹¶å‘æµ‹è¯•
    with ThreadPoolExecutor(max_workers=concurrent_users) as executor:
        futures = [executor.submit(worker) for _ in range(concurrent_users)]
        
        # ç­‰å¾…æ‰€æœ‰æµ‹è¯•å®Œæˆ
        for future in futures:
            future.result()
    
    # åˆ†æç»“æœ
    successful_requests = [r for r in results if r.get("success", False)]
    failed_requests = [r for r in results if not r.get("success", False)]
    
    print(f"æ€»è¯·æ±‚æ•°: {len(results)}")
    print(f"æˆåŠŸè¯·æ±‚: {len(successful_requests)}")
    print(f"å¤±è´¥è¯·æ±‚: {len(failed_requests)}")
    print(f"æˆåŠŸç‡: {len(successful_requests)/len(results)*100:.2f}%")
    
    if successful_requests:
        avg_response_time = sum(r["response_time"] for r in successful_requests) / len(successful_requests)
        print(f"å¹³å‡å“åº”æ—¶é—´: {avg_response_time:.3f}ç§’")

if __name__ == "__main__":
    print("å¼€å§‹è´Ÿè½½æµ‹è¯•...")
    load_test(concurrent_users=5, test_duration=30)
```

### 6.2 æ€§èƒ½ç›‘æ§

åˆ›å»º **monitoring/performance_monitor.py**:
```python
import boto3
import time
from datetime import datetime, timedelta

def get_lambda_metrics(function_name, start_time, end_time):
    """è·å–Lambdaå‡½æ•°æŒ‡æ ‡"""
    cloudwatch = boto3.client('cloudwatch')
    
    metrics = [
        'Duration',
        'Errors', 
        'Invocations',
        'Throttles',
        'ConcurrentExecutions'
    ]
    
    results = {}
    
    for metric in metrics:
        response = cloudwatch.get_metric_statistics(
            Namespace='AWS/Lambda',
            MetricName=metric,
            Dimensions=[
                {
                    'Name': 'FunctionName',
                    'Value': function_name
                }
            ],
            StartTime=start_time,
            EndTime=end_time,
            Period=300,  # 5åˆ†é’Ÿ
            Statistics=['Average', 'Sum', 'Maximum']
        )
        results[metric] = response['Datapoints']
    
    return results

def print_metrics_report(function_name):
    """æ‰“å°æŒ‡æ ‡æŠ¥å‘Š"""
    end_time = datetime.utcnow()
    start_time = end_time - timedelta(hours=1)
    
    metrics = get_lambda_metrics(function_name, start_time, end_time)
    
    print(f"=== {function_name} æ€§èƒ½æŠ¥å‘Š ===")
    print(f"æ—¶é—´èŒƒå›´: {start_time} - {end_time}")
    
    for metric_name, datapoints in metrics.items():
        if datapoints:
            avg_value = sum(dp['Average'] for dp in datapoints) / len(datapoints)
            max_value = max(dp['Maximum'] for dp in datapoints)
            print(f"{metric_name}: å¹³å‡={avg_value:.2f}, æœ€å¤§={max_value:.2f}")
        else:
            print(f"{metric_name}: æ— æ•°æ®")

if __name__ == "__main__":
    function_name = "user-management-api-prod-api"  # æ›¿æ¢ä¸ºä½ çš„å‡½æ•°å
    print_metrics_report(function_name)
```

## ğŸ“ ç¬¬ä¸ƒæ­¥ï¼šå®Œæ•´éƒ¨ç½²è„šæœ¬

åˆ›å»º **deploy.sh**:
```bash
#!/bin/bash

echo "=== äº‘ä¸»æœºåˆ°Serverlesséƒ¨ç½²è„šæœ¬ ==="

# 1. ç¯å¢ƒæ£€æŸ¥
echo "æ£€æŸ¥ç¯å¢ƒ..."
python --version
pip --version

# 2. å®‰è£…ä¾èµ–
echo "å®‰è£…ä¾èµ–..."
pip install -r deployment/requirements.txt

# 3. è¿è¡Œæµ‹è¯•
echo "è¿è¡Œæµ‹è¯•..."
python -m pytest tests/ -v

if [ $? -ne 0 ]; then
    echo "æµ‹è¯•å¤±è´¥ï¼Œåœæ­¢éƒ¨ç½²"
    exit 1
fi

# 4. æ‰“åŒ…ä»£ç 
echo "æ‰“åŒ…ä»£ç ..."
cd deployment
zip -r ../deployment-package.zip ../src/ requirements.txt serverless.yml

# 5. éƒ¨ç½²åˆ°Serverless
echo "éƒ¨ç½²åˆ°Serverless..."
serverless deploy --stage prod

echo "éƒ¨ç½²å®Œæˆï¼"
echo "APIåœ°å€: https://your-api-gateway-url.amazonaws.com/prod"
```

## ğŸ”§ ç¬¬å…«æ­¥ï¼šæ•…éšœæ’æŸ¥æŒ‡å—

### 8.1 å¸¸è§é—®é¢˜è§£å†³

**é—®é¢˜1: å¯¼å…¥æ¨¡å—å¤±è´¥**
```python
# è§£å†³æ–¹æ¡ˆï¼šåœ¨handler.pyä¸­æ·»åŠ è·¯å¾„
import sys
import os
sys.path.append(os.path.dirname(__file__))
```

**é—®é¢˜2: ä¾èµ–åŒ…å¤§å°è¶…é™**
```yaml
# åœ¨serverless.ymlä¸­ä¼˜åŒ–æ‰“åŒ…
custom:
  pythonRequirements:
    slim: true
    strip: false
    noDeps: false
    dockerizePip: true
```

**é—®é¢˜3: å†·å¯åŠ¨æ—¶é—´è¿‡é•¿**
```python
# ä½¿ç”¨è¿æ¥æ± å’Œç¼“å­˜
from functools import lru_cache

@lru_cache(maxsize=1)
def get_service():
    return UserService()
```

### 8.2 æ—¥å¿—ç›‘æ§

**monitoring/log_analyzer.py**:
```python
import boto3
from datetime import datetime, timedelta

def get_lambda_logs(function_name, hours=1):
    """è·å–Lambdaå‡½æ•°æ—¥å¿—"""
    logs_client = boto3.client('logs')
    log_group = f"/aws/lambda/{function_name}"
    
    end_time = datetime.utcnow()
    start_time = end_time - timedelta(hours=hours)
    
    response = logs_client.filter_log_events(
        logGroupName=log_group,
        startTime=int(start_time.timestamp() * 1000),
        endTime=int(end_time.timestamp() * 1000)
    )
    
    return response['events']

def analyze_errors(logs):
    """åˆ†æé”™è¯¯æ—¥å¿—"""
    errors = [log for log in logs if 'ERROR' in log['message']]
    print(f"å‘ç° {len(errors)} ä¸ªé”™è¯¯:")
    
    for error in errors[-5:]:  # æ˜¾ç¤ºæœ€è¿‘5ä¸ªé”™è¯¯
        timestamp = datetime.fromtimestamp(error['timestamp']/1000)
        print(f"[{timestamp}] {error['message']}")

if __name__ == "__main__":
    function_name = "user-management-api-prod-api"
    logs = get_lambda_logs(function_name)
    analyze_errors(logs)
```

## ğŸ“š ç¬¬ä¹æ­¥ï¼šé¡¹ç›®æ–‡æ¡£

åˆ›å»ºå®Œæ•´çš„ **README.md**:
```markdown
# ç”¨æˆ·ç®¡ç†API - Serverlessç‰ˆæœ¬

## é¡¹ç›®æ¦‚è¿°
æœ¬é¡¹ç›®å±•ç¤ºäº†å¦‚ä½•ä»äº‘ä¸»æœºJupyterLabç¯å¢ƒå¼€å‘Python Web APIï¼Œå¹¶å°†å…¶è½¬æ¢éƒ¨ç½²ä¸ºServerlessæœåŠ¡ã€‚

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡
\`\`\`bash
pip install -r deployment/requirements.txt
\`\`\`

### 2. æœ¬åœ°å¼€å‘
\`\`\`bash
cd src
python app.py
\`\`\`

### 3. è¿è¡Œæµ‹è¯•
\`\`\`bash
python -m pytest tests/ -v
\`\`\`

### 4. éƒ¨ç½²
\`\`\`bash
cd deployment
serverless deploy --stage prod
\`\`\`

## APIæ–‡æ¡£

### ç«¯ç‚¹åˆ—è¡¨
- `GET /` - å¥åº·æ£€æŸ¥
- `GET /users` - è·å–ç”¨æˆ·åˆ—è¡¨
- `GET /users/{id}` - è·å–ç‰¹å®šç”¨æˆ·
- `POST /users` - åˆ›å»ºæ–°ç”¨æˆ·

### ç¤ºä¾‹è¯·æ±‚
\`\`\`bash
# è·å–ç”¨æˆ·åˆ—è¡¨
curl https://your-api-url/users

# åˆ›å»ºç”¨æˆ·
curl -X POST https://your-api-url/users \
  -H "Content-Type: application/json" \
  -d '{"name":"å¼ ä¸‰","email":"zhangsan@example.com","age":25}'
\`\`\`

## éƒ¨ç½²æ¶æ„
- **å¼€å‘**: JupyterLab on äº‘ä¸»æœº
- **æµ‹è¯•**: æœ¬åœ°FastAPI + pytest
- **ç”Ÿäº§**: AWS Lambda + API Gateway

## ç›‘æ§
- CloudWatchæŒ‡æ ‡ç›‘æ§
- è‡ªå®šä¹‰æ€§èƒ½æµ‹è¯•è„šæœ¬
- é”™è¯¯æ—¥å¿—åˆ†æå·¥å…·
```

## âœ… æ€»ç»“æ£€æŸ¥æ¸…å•

### å¼€å‘é˜¶æ®µ
- [ ] JupyterLabç¯å¢ƒé…ç½®å®Œæˆ
- [ ] åœ¨notebookä¸­å®ŒæˆåŸå‹å¼€å‘
- [ ] ä»£ç æ¨¡å—åŒ–æ‹†åˆ†å®Œæˆ
- [ ] æœ¬åœ°æµ‹è¯•é€šè¿‡

### è½¬æ¢é˜¶æ®µ  
- [ ] Serverlesså¤„ç†å™¨åˆ›å»º
- [ ] ä¾èµ–æ–‡ä»¶é…ç½®æ­£ç¡®
- [ ] Dockeré…ç½®ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æœ¬åœ°Serverlessæµ‹è¯•é€šè¿‡

### éƒ¨ç½²é˜¶æ®µ
- [ ] é€‰æ‹©Serverlesså¹³å°
- [ ] é…ç½®æ–‡ä»¶å‡†å¤‡å®Œæˆ
- [ ] éƒ¨ç½²è„šæœ¬æµ‹è¯•
- [ ] ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æˆåŠŸ

### ç›‘æ§é˜¶æ®µ
- [ ] æ€§èƒ½ç›‘æ§é…ç½®
- [ ] æ—¥å¿—åˆ†æå·¥å…·éƒ¨ç½²
- [ ] è´Ÿè½½æµ‹è¯•å®Œæˆ
- [ ] æ–‡æ¡£å®Œå–„

## ğŸ‰ æ­å–œï¼

æ‚¨å·²ç»å®Œæˆäº†ä»äº‘ä¸»æœºJupyterLabå¼€å‘åˆ°ServerlessæœåŠ¡éƒ¨ç½²çš„å®Œæ•´æµç¨‹ã€‚è¿™ä¸ªæ–¹æ¡ˆæä¾›äº†ï¼š

1. **å®Œæ•´çš„å¼€å‘ç¯å¢ƒ**: JupyterLabäº¤äº’å¼å¼€å‘
2. **æ¨¡å—åŒ–æ¶æ„**: æ˜“äºç»´æŠ¤å’Œæ‰©å±•
3. **å¤šå¹³å°æ”¯æŒ**: AWSã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘
4. **å®Œå–„çš„æµ‹è¯•**: å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€è´Ÿè½½æµ‹è¯•
5. **ç›‘æ§ä½“ç³»**: æ€§èƒ½ç›‘æ§ã€æ—¥å¿—åˆ†æ
6. **è¯¦ç»†æ–‡æ¡£**: å®Œæ•´çš„ä½¿ç”¨è¯´æ˜

ç°åœ¨æ‚¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¨¡æ¿å¼€å‘æ›´å¤æ‚çš„Serverlessåº”ç”¨ï¼
